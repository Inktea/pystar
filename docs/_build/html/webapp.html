

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Intro to Programming Python: Web App &mdash; PyStar: Programming Workshops for Women and Their Friends</title>
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/pystar_flaming_32_150px.ico"/>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="PyStar: Programming Workshops for Women and Their Friends" href="index.html" />
    <link rel="next" title="Answers for Webapp Questions" href="webapp_answers.html" />
    <link rel="prev" title="7. django" href="dependencies/dep-django.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="index.html">
            <img class="logo" src="_static/pystar_flaming_160_150px.png" alt="Logo"/>
          </a></p>
        <h1><a href="index.html">PyStar: Programming Workshops for Women and Their Friends</a></h1>
        <div class="rel">
          <a href="dependencies/dep-django.html" title="7. django"
             accesskey="P">previous</a> |
          <a href="webapp_answers.html" title="Answers for Webapp Questions"
             accesskey="N">next</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="intro-to-programming-python-web-app">
<span id="webapp-label"></span><h1>Intro to Programming Python: Web App<a class="headerlink" href="#intro-to-programming-python-web-app" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will look at writing and deploying a web application.
The app is an online poll where visitors can view choices
(a bit of text) and vote the option up and down.</p>
<p>We will cover local deployment as well as deploying your web application to the world,
where other people can play with it, and where you can modify it.</p>
<p>This is based <em>heavily</em> on the official tutorial for the Django web programming framework
as well as the <a class="reference external" href="http://www.wiki.devchix.com/index.php?title=Ruby_and_Rails_workshops_for_women">Ruby on Rails for Women</a>
workshop.</p>
<p>If you would like to see an example of this completed tutorial, <a class="reference external" href="https://github.com/lsblakk/myproject">Lukas did it</a></p>
<div class="section" id="part-xx-if-you-build-it-they-will-pay-you">
<h2>Part XX:  If You Build It... They Will Pay You<a class="headerlink" href="#part-xx-if-you-build-it-they-will-pay-you" title="Permalink to this headline">¶</a></h2>
<div class="section" id="the-client">
<h3>The Client<a class="headerlink" href="#the-client" title="Permalink to this headline">¶</a></h3>
<p>VoteOnEverything, Ltd. (VOEL) is a web startup hoping to make some money on this
&#8220;internet&#8221; thing the kids are talking about.  Their idea: <strong>an app where people
can easily create polls on their favorite subjects and vote on them!</strong>
They are flush with cash, and have hired you (you&#8217;re smart, right?) to help out!</p>
</div>
<div class="section" id="example-user-stories">
<h3>Example User Stories<a class="headerlink" href="#example-user-stories" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>As a <em>poll creator</em>, it should be obvious and easy to create polls.</li>
<li>As a <em>visitor</em>, I want stable urls so I can share my polls easily.</li>
<li>As a <em>voter</em>, it should be easy to vote on polls!</li>
<li>As <em>VOEL</em>, I want polls with lots of total votes to be on the front page.</li>
<li>As <em>VOEL</em>, I want to keep track of visitor information, to sell to advertisers,
including their source ip, geography, etc.</li>
<li>As a <em>user</em>, I want the application to keep track of polls I have created,
my voting history.</li>
<li>(many many more)</li>
</ol>
</div>
<div class="section" id="designing-the-prototype">
<h3>Designing The Prototype<a class="headerlink" href="#designing-the-prototype" title="Permalink to this headline">¶</a></h3>
<p>Time to make a prototype!
After hearing about Python and the Django web framework from that
smart girl you know who works at Google, you have decided to try it out!</p>
<p>Since this is a prototype, you have decided to eliminate some features
(logins, history tracking, demographic information, etc.) to focus on the
core applicaion:  polls and voting.</p>
<p>You have decided to implement the following pages:</p>
<ol class="arabic simple">
<li>Poll “index” page – displays the latest few polls.</li>
<li>Poll “detail” page – displays a poll question, with no results but with a form to vote.</li>
<li>Poll “results” page – displays results for a particular poll.</li>
<li>Vote action – handles voting for a particular choice in a particular poll.</li>
</ol>
<p>To support these pages, you need these abstractions (models, objects):</p>
<ol class="arabic simple">
<li>Polls</li>
<li>Choices</li>
<li>Votes</li>
</ol>
</div>
</div>
<div class="section" id="part-xx-create-your-django-app">
<h2>Part XX Create your Django App<a class="headerlink" href="#part-xx-create-your-django-app" title="Permalink to this headline">¶</a></h2>
<p>Goal:  Configure and explore a basic Django &#8220;out of the box app&#8221;.</p>
<div class="section" id="create-necessary-directories-activate-virtualenv">
<h3>Create necessary directories, activate virtualenv<a class="headerlink" href="#create-necessary-directories-activate-virtualenv" title="Permalink to this headline">¶</a></h3>
<p>(You may have already done this!)</p>
<p>In your terminal, starting from somewhere reasonable (here, <tt class="docutils literal"><span class="pre">mydir</span></tt>)</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd </span>mydir
mkdir django_projects
virtualenv --no-site-packages pystar
<span class="c"># New python executable in pystar/bin/python</span>
<span class="c"># Installing setuptools............done.</span>
<span class="nb">source </span>pystar/bin/activate  <span class="c"># windows -&gt; pystar\Scripts\activate.bat</span>
<span class="c"># (pystar)My-MacBook-Pro:mydir $</span>
<span class="c"># $ ls .</span>
<span class="c"># django_projects pystar</span>
</pre></div>
</div>
</div>
<div class="section" id="switch-to-the-right-directory">
<h3>Switch to the right directory<a class="headerlink" href="#switch-to-the-right-directory" title="Permalink to this headline">¶</a></h3>
<p>In a terminal (or GitBash), get into the <tt class="docutils literal"><span class="pre">django_projects</span></tt> directory
we created in the Friday setup portion of the tutorial.</p>
<p>You can do that by typing this into your terminal:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd </span>django_projects
</pre></div>
</div>
<p>In the Friday setup portion of the workshop, you already saw how
to use the <tt class="docutils literal"><span class="pre">django-admin.py</span></tt> command to start a project.
Let&#8217;s go into it and start looking around.</p>
<div class="highlight-bash"><div class="highlight"><pre>django-admin startproject myproject <span class="c"># if you haven&#39;t already got a my_project</span>
<span class="nb">cd </span>myproject
</pre></div>
</div>
</div>
<div class="section" id="look-at-the-files">
<h3>Look at the files<a class="headerlink" href="#look-at-the-files" title="Permalink to this headline">¶</a></h3>
<p>Let’s look at files in the project (you can ignore any .pyc files). The default Django app should
look like this:</p>
<div class="highlight-bash"><div class="highlight"><pre>ls
    __init__.py
    manage.py
    settings.py
    urls.py
</pre></div>
</div>
<p>These files are:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">__init__.py</span></tt>: An empty file that tells Python that this directory should be considered a Python module. Because of the <tt class="docutils literal"><span class="pre">__init__.py</span></tt> file, you can use <tt class="docutils literal"><span class="pre">import</span></tt> to <tt class="docutils literal"><span class="pre">import</span> <span class="pre">myproject</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">manage.py</span></tt>: A command-line utility that lets you interact with this Django project in various ways. You can read all the details about <tt class="docutils literal"><span class="pre">manage.py</span></tt> in <tt class="docutils literal"><span class="pre">django-admin.py</span></tt> and <tt class="docutils literal"><span class="pre">manage.py</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">settings.py</span></tt>: Settings/configuration for this Django project. Django settings will tell you all about how settings work.</li>
<li><tt class="docutils literal"><span class="pre">urls.py</span></tt>: The URL declarations for this Django project; a &#8220;table of contents&#8221; of your Django-powered site. You can read more about URLs in URL dispatcher.</li>
</ul>
</div>
<div class="section" id="start-the-development-local-server">
<h3>Start the Development (Local) Server<a class="headerlink" href="#start-the-development-local-server" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Verify the development server will start.</p>
<blockquote>
<div><ol class="loweralpha">
<li><p class="first">Run the command:</p>
<div class="highlight-bash"><div class="highlight"><pre>python manage.py runserver
</pre></div>
</div>
</li>
<li><p class="first">Review the output in your terminal.  It should look similar to:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>Validating models...
0 errors found.

Django version 1.2, using settings <span class="s1">&#39;myproject.settings&#39;</span>
Development server is running at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<blockquote>
<div></div></blockquote>
</div></blockquote>
</li>
<li><p class="first">Now that the server&#8217;s running, visit <a class="reference external" href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> with your Web browser.
You&#8217;ll see a &#8220;Welcome to Django&#8221; page, in pleasant, light-blue pastel. It worked!</p>
<img alt="_images/itworks5.png" src="_images/itworks5.png" />
<p>Note how mouthy this is, and that it mentions <tt class="docutils literal"><span class="pre">DEBUG</span></tt>, <tt class="docutils literal"><span class="pre">settings.py</span></tt>, and
a lot more, which will be covered in later sections.</p>
<div class="highlight-python"><pre>Of course, you haven't actually done any work yet. Here's what to do next:
If you plan to use a database, edit the DATABASES setting in myproject/settings.py.
Start your first app by running python myproject/manage.py startapp [appname].
You're seeing this message because you have DEBUG = True in your Django settings
file and you haven't configured any URLs. Get to work!</pre>
</div>
</li>
<li><p class="first">Exit the server</p>
<ol class="arabic simple">
<li>return to the terminal instance where the development server is running</li>
<li>pressing CONTROL-C on your keyboard</li>
<li>VERIFY your server is shut down.  How do you do this?  [<a class="reference internal" href="webapp_answers.html#webapp-answers-verify-shutdown"><em>answer</em></a>]</li>
</ol>
</li>
<li><p class="first"><strong>Experiment</strong>:  These two commands are identical:</p>
<div class="highlight-bash"><div class="highlight"><pre>python manage.py runserver
python manage.py runserver 8000
</pre></div>
</div>
<p><em>Start</em> a server on port 8103, and <em>navigate</em> to it using your browser.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="part-xx-save-your-work">
<h2>Part XX Save your work!<a class="headerlink" href="#part-xx-save-your-work" title="Permalink to this headline">¶</a></h2>
<p>Before we do anything else, let&#8217;s save our work and start it with the world.</p>
<p>We&#8217;ll do that with <tt class="docutils literal"><span class="pre">git</span></tt> and <tt class="docutils literal"><span class="pre">Github</span></tt>. On your own computer, get to a Terminal or a GitBash.</p>
<ol class="arabic">
<li><p class="first"><tt class="docutils literal"><span class="pre">cd</span></tt> to get into the <tt class="docutils literal"><span class="pre">myproject</span></tt> directory. If it&#8217;s a fresh Terminal, this is what you&#8217;ll do:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd</span> ~/django_projects/myproject
</pre></div>
</div>
</li>
<li><p class="first">Is this new project?  (It is!)  So:</p>
<ol class="arabic">
<li><p class="first">create a git repository in the project directory:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="c"># in myproject</span>
git init
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Tell git to ignore any files that end with .pyc (compiled python code) when we push
to our repo so we need to add that to <tt class="docutils literal"><span class="pre">.git/info/exclude</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># in myproject directory</span>
gedit .git/info/exclude

<span class="c"># add this line to the end of the file</span>
<span class="c"># excludes all compiled python files, which aren&#39;t interesting.</span>
.pyc
</pre></div>
</div>
</li>
<li><p class="first">Create your project on GitHub.  Go to <a class="reference external" href="http://github.com/">http://github.com/</a> and create a new repository called &#8220;myproject&#8221;. On the main dashboard page, click on &#8220;New Repository&#8221; fill out the necessary information. cf:  <a class="reference external" href="http://help.github.com/create-a-repo/">http://help.github.com/create-a-repo/</a>.</p>
</li>
</ol>
</li>
<li><p class="first">Add all your files to the repo, in the local directory:</p>
<div class="highlight-bash"><div class="highlight"><pre>git add *.py   <span class="c"># all .py files, using a wildcard match.</span>
</pre></div>
</div>
<p>Now git is aware of your files.  Use <tt class="docutils literal"><span class="pre">git</span> <span class="pre">status</span></tt> to see them there in
the <em>staging</em> area (the index).</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">git</span> <span class="pre">commit</span></tt> to <tt class="docutils literal"><span class="pre">commit</span></tt> those files:</p>
<div class="highlight-bash"><div class="highlight"><pre>git commit -m <span class="s2">&quot;Initial commit of django project from the PyStar workshop&quot;</span>
</pre></div>
</div>
<p>Look at your changes with  <tt class="docutils literal"><span class="pre">git</span> <span class="pre">log</span></tt> to see your history.</p>
</li>
<li><p class="first">Connect the remote github repo to your local one, and use <tt class="docutils literal"><span class="pre">git</span> <span class="pre">push</span></tt> to push those up to your Github repository:</p>
<div class="highlight-bash"><div class="highlight"><pre>git remote add origin git@github.com:username/myproject.git
git push origin master
</pre></div>
</div>
</li>
<li><p class="first">Go to your Github account in your browser. Find the <tt class="docutils literal"><span class="pre">myproject</span></tt> repository. Do you see your files?</p>
</li>
<li><p class="first">Remember:</p>
<ul class="simple">
<li>&#8220;commit your work&#8221; means &#8220;add and commit it to the local repository</li>
<li>&#8220;push your work&#8221; means &#8220;git push it to github&#8221;</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="part-xx-configure-your-django-project">
<h2>Part XX:  Configure your Django Project<a class="headerlink" href="#part-xx-configure-your-django-project" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a the scaffolding for our <strong>project</strong> in place, we can con</p>
<div class="section" id="fix-security-settings">
<h3>Fix security settings<a class="headerlink" href="#fix-security-settings" title="Permalink to this headline">¶</a></h3>
<p>Right now, everyone in the workshop has the same &#8220;SECRET_KEY&#8221;. Since Django
uses this</p>
<ol class="arabic">
<li><p class="first">Open  <tt class="docutils literal"><span class="pre">settings.py</span></tt> in your editor.  <tt class="docutils literal"><span class="pre">settings.py</span></tt> is a Python script that only contains variable definitions.  Django looks at the values of these variables when it runs your web app.</p>
</li>
<li><p class="first">Find the variable named <tt class="docutils literal"><span class="pre">SECRET_KEY</span></tt> and set it to whatever string
you want.</p>
</li>
<li><p class="first">Verify it looks something like:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="c"># change this to something arbitrary.</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">&#39;6yl8d1u0+ogcz!0@3_%au)_&amp;ty$%1jcs2hy-!&amp;v&amp;vv2#@pq^(h&#39;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">What if we wanted a single-quote (&#8216;) in our SECRET_KEY?  [<a class="reference internal" href="webapp_answers.html#webapp-answers-single-quote"><em>answer</em></a>]</p>
</li>
<li><p class="first">save the file.</p>
</li>
</ol>
</div>
<div class="section" id="set-up-the-database">
<h3>Set up the Database<a class="headerlink" href="#set-up-the-database" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Keep looking at <tt class="docutils literal"><span class="pre">settings.py</span></tt>: The <tt class="docutils literal"><span class="pre">DATABASES</span></tt> variable is a dictionary
(note the &#8216;{}&#8217; characters) with one key: <tt class="docutils literal"><span class="pre">default</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;django.db.backends.&#39;</span><span class="p">,</span> <span class="c"># Add &#39;postgresql_psycopg2&#39;, &#39;postgresql&#39;, &#39;mysql&#39;, &#39;sqlite3&#39; or &#39;oracle&#39;.</span>
        <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>                      <span class="c"># Or path to database file if using sqlite3.</span>
        <span class="s">&#39;USER&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>                      <span class="c"># Not used with sqlite3.</span>
        <span class="s">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>                  <span class="c"># Not used with sqlite3.</span>
        <span class="s">&#39;HOST&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>                      <span class="c"># Set to empty string for localhost. Not used with sqlite3.</span>
        <span class="s">&#39;PORT&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>                      <span class="c"># Set to empty string for default. Not used with sqlite3.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Notice that the value of <tt class="docutils literal"><span class="pre">default</span></tt> is itself another dictionary with information about the site&#8217;s default  database. We&#8217;re going to set our app to use a <tt class="docutils literal"><span class="pre">sqlite</span></tt> database.
Sqlite is great for development because is stores its data in one normal file on
your system and therefore is really simple to move around with your app.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In production, Sqlite has issues because only one process can <em>write</em> to it
as a time.  <strong>Discuss</strong> the implications of this with your group.</p>
</div>
</li>
<li><p class="first">Edit the lines in your settings.py to match the lines below:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="s1">&#39;ENGINE&#39;</span>: <span class="s1">&#39;django.db.backends.sqlite3&#39;</span>, <span class="c"># Add &#39;postgresql_psycopg2&#39;, &#39;postgresql&#39;, &#39;mysql&#39;, &#39;sqlite3&#39; or &#39;oracle&#39;.</span>
<span class="s1">&#39;NAME&#39;</span>: <span class="s1">&#39;database.db&#39;</span>,
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">NAME</span></tt> key tells the Django project to use a file called <tt class="docutils literal"><span class="pre">database.db</span></tt> to store information for this project.</p>
</li>
<li><p class="first"><strong>Pop quiz</strong>: Does <tt class="docutils literal"><span class="pre">database.db</span></tt> exist right now?  Find out!  [<a class="reference internal" href="webapp_answers.html#webapp-answers-database-db-exists"><em>answer</em></a>]</p>
</li>
<li><p class="first">Notice the <tt class="docutils literal"><span class="pre">INSTALLED_APPS</span></tt> setting towards the
bottom of the <tt class="docutils literal"><span class="pre">settings.py</span></tt>. That variable (a tuple... note the &#8216;()&#8217; symbols)
holds the names of all Django applications that are activated in this Django instance.
<strong>Apps</strong> can be used in multiple projects, and you can
package and distribute them for use by others in their projects.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sites&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="c"># Uncomment the next line to enable the admin:</span>
    <span class="c"># &#39;django.contrib.admin&#39;,</span>
    <span class="c"># Uncomment the next line to enable admin documentation:</span>
    <span class="c"># &#39;django.contrib.admindocs&#39;,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>What do you think these various <strong>apps</strong> do?  Why does it make sense
for them to come in a standard configuration?
[<a class="reference internal" href="webapp_answers.html#webapp-answers-django-standard-apps"><em>answer</em></a>]</p>
</li>
<li><p class="first">Each of these applications makes use of at least one database table, so we need to create
the tables in the database before we can use them. To do that, run the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre>python manage.py syncdb
</pre></div>
</div>
<p>The syncdb command looks at the <tt class="docutils literal"><span class="pre">INSTALLED_APPS</span></tt> setting and creates any necessary
database tables according to the database settings in your <tt class="docutils literal"><span class="pre">settings.py</span></tt> file. You&#8217;ll see a
message for each database table it creates, and you&#8217;ll get a prompt asking you if you&#8217;d
ike to create a superuser account for the authentication system. Go ahead and do that.</p>
<p>Does this seem magical?  [<a class="reference internal" href="webapp_answers.html#webapp-answers-django-magical"><em>answer</em></a>]</p>
</li>
<li><p class="first"><strong>Pop quiz</strong>: Does <tt class="docutils literal"><span class="pre">database.db</span></tt> exist right now?  Find out!  [<a class="reference internal" href="webapp_answers.html#webapp-answers-database-db-exists-after-sync"><em>answer</em></a>]</p>
</li>
<li><p class="first">Drink some tea and take a stretch break.</p>
</li>
</ol>
</div>
<div class="section" id="workflow">
<h3>Workflow!<a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h3>
<p>Make this your work flow:</p>
<ol class="arabic simple">
<li>Design a feature, and criteria for acceptance.</li>
<li>Test your feature!</li>
<li>When it works (or you make good progress) [<a class="reference internal" href="webapp_answers.html#webapp-answers-verify-shutdown"><em>save your work!</em></a>]</li>
</ol>
</div>
<div class="section" id="version-control-detour">
<h3>Version Control Detour!<a class="headerlink" href="#version-control-detour" title="Permalink to this headline">¶</a></h3>
<p>Your work is saved right?</p>
<p>Right?</p>
<p>Good. Because you got a case of the accidental-deletes and you&#8217;ve deleted your settings.py file!</p>
<p>No really. Go and delete settings.py. Throw it in the trash. Or the recycling bin. Or rm from the command line.</p>
<p>Try running your dev server. What happens? Why?</p>
<p>Delete settings.pyc. Try running your dev server. What happens now? Why?</p>
<p>So they&#8217;re gone right? No way back. And everything&#8217;s broken!</p>
<p>Or not. Because we&#8217;re using version control and version control is about to save your bacon!</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git checkout settings.py
</pre></div>
</div>
<p>Look at your project folder again. Lo and behold, settings.py! Back from beyond the grave! Cool, huh? Open it up. All your stuff is there!</p>
<p>But what of settings.pyc? Start your dev server. It works, right? Stop your dev server and look at the files in your project. Do you see settings.pyc? How did it get there?</p>
<p>[<a class="reference internal" href="webapp_answers.html#webapp-answers-pyc-files"><em>answers to above questions, not life, the universe and everything</em></a>]</p>
</div>
</div>
<div class="section" id="part-xx-test-your-django-app">
<h2>Part XX Test your Django App<a class="headerlink" href="#part-xx-test-your-django-app" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Copy <a class="reference download internal" href="_downloads/test_polls.py"><tt class="xref download docutils literal"><span class="pre">test_polls.py</span></tt></a> into your project directory (i.e., in <tt class="docutils literal"><span class="pre">myproject</span></tt>)</p>
</li>
<li><p class="first">Add it into your project code git repo:</p>
<div class="highlight-bash"><div class="highlight"><pre>git add tests_polls.py
git commit tests_polls.py
</pre></div>
</div>
</li>
<li><p class="first">Run the tests</p>
<div class="highlight-bash"><div class="highlight"><pre>python manage.py <span class="nb">test</span>
</pre></div>
</div>
</li>
<li><p class="first">Examine <tt class="docutils literal"><span class="pre">polls_tests.py</span></tt> in your editor.</p>
</li>
</ol>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://docs.djangoproject.com/en/dev/topics/testing/">http://docs.djangoproject.com/en/dev/topics/testing/</a>, which
goes into this in much greater detail.  In particualar,</p>
</div>
</div>
<div class="section" id="part-xx-philosphy-break">
<h2>Part XX  Philosphy Break!<a class="headerlink" href="#part-xx-philosphy-break" title="Permalink to this headline">¶</a></h2>
<p>[Not done!]</p>
</div>
<div class="section" id="part-xx-build-the-polls-application">
<h2>Part XX Build The Polls Application<a class="headerlink" href="#part-xx-build-the-polls-application" title="Permalink to this headline">¶</a></h2>
<p>This tutorial (as a whole) walks you through the creation of a basic poll application.</p>
<p>It’ll consist of two parts:</p>
<ul class="simple">
<li>A public site that lets people view polls and vote in them.</li>
<li>An admin site that lets you add, change and delete polls.</li>
</ul>
<div class="section" id="creating-some-data-models">
<h3>Creating some data <em>models</em><a class="headerlink" href="#creating-some-data-models" title="Permalink to this headline">¶</a></h3>
<p>Now that your environment &#8211; a &#8220;project&#8221; &#8211; is set up, you&#8217;re set to start building the poll.</p>
<p>Each application you write in Django consists of a Python package,
somewhere on your Python path, that follows a certain convention.
Django comes with a utility that automatically generates the basic directory
structure of an app, so you can focus on writing code rather than creating directories.</p>
</div>
<div class="section" id="projects-and-apps">
<h3>Projects and Apps<a class="headerlink" href="#projects-and-apps" title="Permalink to this headline">¶</a></h3>
<p>We&#8217;ve talked a little about Django <strong>apps</strong> and <strong>projects</strong>. You might be
wondering what the difference is.</p>
<p>Here are the things to know:</p>
<ul class="simple">
<li>An <strong>app</strong> is component of a website that does something. For example, the <strong>Django administration</strong> app is something you&#8217;ll see later in this tutorial.  So will our <tt class="docutils literal"><span class="pre">polls</span></tt> app.</li>
<li>A <strong>project</strong> corresponds to a website: it contains a <tt class="docutils literal"><span class="pre">settings.py</span></tt> file, so it has a corresponding database.</li>
</ul>
<p>Django apps can live anywhere on the <strong>Python path</strong>.  The <strong>python path</strong> is
a list of paths where the python interpreter looks for modules.  To see yours
(for the curious):</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python
&gt;&gt;&gt; import sys
&gt;&gt;&gt; sys.path
<span class="o">[</span><span class="s1">&#39;&#39;</span>, <span class="s1">&#39;/Users/gregg/mydir/pystar/lib/python2.6/site-packages/setuptools-0.6c11-py2.6.egg&#39;</span>,
<span class="s1">&#39;/Users/gregg/mydir/pystar/lib/python2.6/site-packages/pip-0.8.3-py2.6.egg&#39;</span>,
<span class="s1">&#39;/Users/gregg/mydir/pystar/lib/python26.zip&#39;</span>,
<span class="s1">&#39;/Users/gregg/mydir/pystar/lib/python2.6&#39;</span>,
<span class="s1">&#39;/Users/gregg/mydir/pystar/lib/python2.6/plat-darwin&#39;</span>,
<span class="s1">&#39;/Users/gregg/mydir/pystar/lib/python2.6/plat-mac&#39;</span> ... <span class="o">]</span>
</pre></div>
</div>
<p>To be importable (seeable by Python), your Django app must be in one of the folders
on <em>your</em> path.</p>
<p>In this tutorial, we&#8217;ll create our poll app in the myproject directory for
simplicity. In the future, when you decide that the world needs to be able to
use your poll app and plug it into their own projects, you can publish that
directory separately.</p>
<p>To create your app, make sure you&#8217;re in the myproject directory and type this command:</p>
<div class="highlight-bash"><div class="highlight"><pre>python manage.py startapp polls
</pre></div>
</div>
<p>That&#8217;ll create a directory polls, which is laid out like this:</p>
<div class="highlight-bash"><div class="highlight"><pre>polls/
   __init__.py
   models.py
   tests.py
   views.py
</pre></div>
</div>
<p>This directory structure will house the poll application.</p>
<p>The first step in writing a database Web app in Django is to
define your models &#8211; essentially, your database layout, with additional metadata.</p>
</div>
<div class="section" id="django-philosophy">
<h3>Django Philosophy<a class="headerlink" href="#django-philosophy" title="Permalink to this headline">¶</a></h3>
<p>A model is the single, definitive source of data about your data.
It contains the essential fields and behaviors of the data you&#8217;re storing.
Django follows the DRY (&#8220;Don&#8217;t Repeat Yourself&#8221;) Principle. The goal is to
define your data model in one place and automatically derive things from it.</p>
<p>(If you&#8217;ve used SQL before, you might be interested to know that each
Django <tt class="docutils literal"><span class="pre">model</span></tt> corresponds to a SQL <tt class="docutils literal"><span class="pre">table</span></tt>.)</p>
<p>In our simple poll app, we&#8217;ll create two models: polls and choices.
A poll has a question and a publication date. A choice has two fields: the
text of the choice and a vote tally. Each choice is associated with a poll.</p>
<p>These concepts are represented by Python classes.
Edit the polls/models.py file so it looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Poll</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Choice</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">poll</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Poll</span><span class="p">)</span>
    <span class="n">choice</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">votes</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
</pre></div>
</div>
<p>Save the models.py file.</p>
<p>All models in Django code are represented by a class that subclasses
django.db.models.Model. Each model has a number of class variables,
each of which represents a database field in the model.</p>
<p>Each field is represented by an instance of a Field class &#8211; e.g., CharField
for character fields and DateTimeField for datetimes. This tells Django
what type of data each field holds.</p>
<p>The name of each Field instance (e.g. question or pub_date) is the field&#8217;s
name, in machine-friendly format. You&#8217;ll use this value in your Python code,
and your database will use it as the column name.</p>
<p>Some Field classes have required elements. CharField, for example, requires
that you give it a max_length. That&#8217;s used not only in the database schema,
but in validation, as we&#8217;ll soon see.</p>
<p>Finally, note a relationship is defined, using ForeignKey. That tells Django each
Choice is related to a single Poll. Django supports all the common database
relationships: many-to-ones, many-to-manys and one-to-ones.</p>
</div>
<div class="section" id="activating-models">
<h3>Activating models<a class="headerlink" href="#activating-models" title="Permalink to this headline">¶</a></h3>
<p>That small bit of model code gives Django a lot of information. With it, Django is able to:</p>
<ul class="simple">
<li>Create a database schema (CREATE TABLE statements) for this app.</li>
<li>Create a Python database-access API for accessing Poll and Choice objects.</li>
</ul>
<p>But first we need to tell our project that the polls app is installed.</p>
</div>
<div class="section" id="id1">
<h3>Django Philosophy<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Django apps are &#8220;pluggable&#8221;: You can use an app in multiple projects, and
you can distribute apps, because they don&#8217;t have to be tied to a given Django installation.</p>
<p>Edit the settings.py file again, and change the INSTALLED_APPS setting to
include the string &#8216;polls&#8217;. So it&#8217;ll look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sites&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="c"># Uncomment the next line to enable the admin:</span>
    <span class="c"># &#39;django.contrib.admin&#39;,</span>
    <span class="c"># Uncomment the next line to enable admin documentation:</span>
    <span class="c"># &#39;django.contrib.admindocs&#39;,</span>
     <span class="s">&#39;polls&#39;</span><span class="p">,</span>
 <span class="p">)</span>
</pre></div>
</div>
<p>Save the settings.py file.</p>
<p>Now Django knows to include the polls app.</p>
<p>If you care about SQL, you can try the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre>python manage.py sql polls
</pre></div>
</div>
<p>For now, let&#8217;s just Django&#8217;s <tt class="docutils literal"><span class="pre">syncdb</span></tt> tool to create the database tables for Poll objects:</p>
<div class="highlight-bash"><div class="highlight"><pre>python manage.py syncdb
</pre></div>
</div>
<p>The syncdb looks for <tt class="docutils literal"><span class="pre">apps</span></tt> that have not yet been set up. To set them up,
it runs the necessary SQL commands against your database. This creates all the
tables, initial data and indexes for any apps you have added to your project since
the last time you ran syncdb. syncdb can be called as often as you like, and it
will only ever create the tables that don&#8217;t exist.</p>
<p><cite>More info</cite>: Read the django-admin.py <a class="reference external" href="http://docs.djangoproject.com/en/dev/ref/django-admin/">documentation</a> for full information on what the manage.py utility can do.</p>
</div>
<div class="section" id="playing-with-the-api">
<h3>Playing with the API<a class="headerlink" href="#playing-with-the-api" title="Permalink to this headline">¶</a></h3>
<p>Now, let&#8217;s hop into the interactive Python shell and play around with
the free API Django gives you. To invoke the Python shell, use this command:</p>
<div class="highlight-bash"><div class="highlight"><pre>python manage.py shell
</pre></div>
</div>
<p>We&#8217;re using this instead of simply typing &#8220;python&#8221;, because manage.py sets
up the project&#8217;s environment for you. &#8220;Setting up the environment&#8221; involves two things:</p>
<p># Making sure <tt class="docutils literal"><span class="pre">polls</span></tt> is on the right path to be imported.
# Setting the DJANGO_SETTINGS_MODULE environment variable, which gives Django the path to your settings.py file.</p>
<p>Once you&#8217;re in the shell, explore the database API:</p>
<p>Let&#8217;s import the model classes we just wrote:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Poll</span><span class="p">,</span> <span class="n">Choice</span>
</pre></div>
</div>
<p>To list all the current Polls:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[]</span>
</pre></div>
</div>
<p>It is an empty list because there are no polls. Let&#8217;s add one!</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Poll</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="s">&quot;What&#39;s up?&quot;</span><span class="p">,</span> <span class="n">pub_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</pre></div>
</div>
<p>Then we&#8217;ll save the object into the database. You have to call save() explicitly.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Great. Now, because it&#8217;s been saved, it has an ID in the database. You can see that by typing this into the Python shell:</p>
<div class="highlight-python"><pre>.. code-block:: python</pre>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">id</span>
<span class="go">1</span>
</pre></div>
</div>
<p>You can also access the database columns (Fields, in Django parlance) as Python attributes:</p>
<div class="highlight-python"><pre>.. code-block:: python</pre>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">question</span>
<span class="go">&quot;What&#39;s up?&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">pub_date</span>
<span class="go">datetime.datetime(2007, 7, 15, 12, 00, 53)</span>
</pre></div>
</div>
<p>We can time travel back in time! Or at least, we can send the Poll back in time:</p>
<div class="highlight-python"><pre>.. code-block:: python</pre>
</div>
<blockquote>
<div># Change values by changing the attributes, then calling save().
&gt;&gt;&gt; p.pub_date = datetime.datetime(2007, 4, 1, 0, 0)
&gt;&gt;&gt; p.save()
&gt;&gt;&gt; p.pub_date
datetime.datetime(2007, 4, 1, 0, 0)</div></blockquote>
<p>Finally, we can also ask Django to show a list of all the Poll objects available:</p>
<div class="highlight-python"><pre>.. code-block:: python</pre>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;Poll: Poll object&gt;]</span>
</pre></div>
</div>
<p>Wait a minute. &lt;Poll: Poll object&gt; is an utterly unhelpful representation of this object. Let&#8217;s fix that by editing the polls model
Use your <tt class="docutils literal"><span class="pre">'text</span> <span class="pre">editor</span></tt>&#8216; to open the polls/models.py file and adding a __unicode__() method to both Poll and Choice:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Poll</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">question</span>

<span class="k">class</span> <span class="nc">Choice</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">choice</span>
</pre></div>
</div>
<p>It&#8217;s important to add __unicode__() methods to your models, not only for your own sanity when dealing with the interactive prompt, but also because objects&#8217; representations are used throughout Django&#8217;s automatically-generated admin.</p>
<p>(If you&#8217;re using to Python programming from a time in the past, you might have seen __str__(). Django prefers you use __unicode__() instead.)</p>
<p>Note these are normal Python methods. Let&#8217;s add a custom method, just for demonstration:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">datetime</span>
<span class="c"># ...</span>
<span class="k">class</span> <span class="nc">Poll</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">def</span> <span class="nf">was_published_today</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
</pre></div>
</div>
<p>Note the addition of import datetime to reference Python&#8217;s standard datetime module. This allows
us to use the datetime library module in models.py by calling it with datetime. To see what functions
come with a module, you can test it in the interactive shell:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">dir</span><span class="p">(</span><span class="n">datetime</span><span class="p">)</span>
<span class="go">[&#39;MAXYEAR&#39;, &#39;MINYEAR&#39;, &#39;__doc__&#39;, &#39;__file__&#39;, &#39;__name__&#39;, &#39;__package__&#39;, &#39;date&#39;, &#39;datetime&#39;,</span>
<span class="go">&#39;datetime_CAPI&#39;, &#39;time&#39;, &#39;timedelta&#39;, &#39;tzinfo&#39;]</span>
</pre></div>
</div>
<p>Save these changes to the models.py file, and then start a new Python interactive shell by running python manage.py shell again:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Poll</span><span class="p">,</span> <span class="n">Choice</span>
</pre></div>
</div>
<p>Check it out: our __unicode__() addition worked:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;Poll: What&#39;s up?&gt;]</span>
</pre></div>
</div>
<p>If you want to search your database, you can do it using the <tt class="docutils literal"><span class="pre">'filter</span></tt>&#8216; method on the <tt class="docutils literal"><span class="pre">objects</span></tt> attribute of Poll. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">polls</span> <span class="o">=</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="s">&quot;What&#39;s up?&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">polls</span>
<span class="go">[&lt;Poll: What&#39;s up?&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">polls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
<span class="go">1</span>
</pre></div>
</div>
<p>If you try to search for a poll that does not exist, <tt class="docutils literal"><span class="pre">filter</span></tt> will give you the empty list. The <tt class="docutils literal"><span class="pre">'get</span></tt>&#8216; method will always return one hit, or raise an exception.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="s">&quot;What time is it?&quot;</span><span class="p">)</span>
<span class="go">[]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;Poll: What&#39;s up?&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
    <span class="o">...</span>
<span class="gr">DoesNotExist</span>: <span class="n">Poll matching query does not exist.</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-choices">
<h3>Adding choices<a class="headerlink" href="#adding-choices" title="Permalink to this headline">¶</a></h3>
<p>Right now, we have a Poll in the database, but it has no Choices. See:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[]</span>
</pre></div>
</div>
<p>So let&#8217;s create three choices:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">choice</span><span class="o">=</span><span class="s">&#39;Not much&#39;</span><span class="p">,</span> <span class="n">votes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">&lt;Choice: Not much&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">choice</span><span class="o">=</span><span class="s">&#39;The sky&#39;</span><span class="p">,</span> <span class="n">votes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">&lt;Choice: The sky&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">choice</span><span class="o">=</span><span class="s">&#39;Just hacking again&#39;</span><span class="p">,</span> <span class="n">votes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span>
<span class="go">&lt;Choice: Just hacking again&gt;</span>
</pre></div>
</div>
<p>Every Choice can find the Poll that it belongs to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">poll</span>
<span class="go">&lt;Poll: What&#39;s up?&gt;</span>
</pre></div>
</div>
<p>We just used this, but now I&#8217;ll explain it: Because a Poll can have more than one Choice, Django creates the <tt class="docutils literal"><span class="pre">'choice_set</span></tt>&#8216; attribute on each Poll. You can use that to look at the list of available Choices, or to create them.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;Choice: Not much&gt;, &lt;Choice: The sky&gt;, &lt;Choice: Just hacking again&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="go">3</span>
</pre></div>
</div>
</div>
<div class="section" id="visualize-the-database-in-sqlite-manager">
<h3>Visualize the database in SQLite Manager<a class="headerlink" href="#visualize-the-database-in-sqlite-manager" title="Permalink to this headline">¶</a></h3>
<p>This is optional, but interesting if you want to see your database in a GUI and/or
know how to access your database.db from outside the project.</p>
<p>When you call <tt class="docutils literal"><span class="pre">.save()</span></tt> on a model instance, Django saves that to the database.
(Remember, Django is a web programming framework built around the idea of
saving data in a SQL database.)</p>
<p>Where <tt class="docutils literal"><span class="pre">is</span></tt> that database? Take a look at <tt class="docutils literal"><span class="pre">'settings.py</span></tt>&#8216; in your text editor. You
can see that <tt class="docutils literal"><span class="pre">database.db</span></tt> is the filename. In <tt class="docutils literal"><span class="pre">'settings.py</span></tt>&#8216; Python calculates
the path to the current file.</p>
<p>So now:</p>
<ul class="simple">
<li>Open up Firefox</li>
<li>Find SQLite Manager in <tt class="docutils literal"><span class="pre">'Tools</span></tt>&#8216;-&gt;``&#8217;SQLite Manager``&#8217;</li>
<li>In the SQLite Manager menus, choose: <tt class="docutils literal"><span class="pre">'Database</span></tt>&#8216;-&gt;``&#8217;Connect Database``&#8217;</li>
<li>Find the <tt class="docutils literal"><span class="pre">'pystar/django_projects/myproject/database.db</span></tt>&#8216; file.</li>
</ul>
<p>Browse your tables! This is another way of looking at the data you just created.</p>
<p><tt class="docutils literal"><span class="pre">'Note</span></tt>&#8216;: In order to find the <tt class="docutils literal"><span class="pre">database.db</span></tt> file, you might need to ask SQLite
Manager to show you all files, not just the <tt class="docutils literal"><span class="pre">\*.sqlite</span></tt> files.</p>
<p>Now you know that you be able to find this
database file. Browse around! Hooray.</p>
<p>When you&#8217;re satisfied with your Poll data, you can close it.</p>
<p>!!!! Save your WORK!!!!!!!</p>
</div>
<div class="section" id="enough-databases-for-now">
<h3>Enough databases for now<a class="headerlink" href="#enough-databases-for-now" title="Permalink to this headline">¶</a></h3>
<p>In the next section of the tutorial, you&#8217;ll write <tt class="docutils literal"><span class="pre">views</span></tt> that let other people look at your polls.</p>
</div>
</div>
<div class="section" id="part-xx-letting-the-local-world-see-your-polls-with-views">
<h2>Part XX Letting the (local) world see your polls, with views<a class="headerlink" href="#part-xx-letting-the-local-world-see-your-polls-with-views" title="Permalink to this headline">¶</a></h2>
<p>We have all these polls in our database. However, no one can see them, because we never
made any web pages that <tt class="docutils literal"><span class="pre">render</span></tt> the polls into HTML.</p>
<p>Let&#8217;s change that with Django views.</p>
<div class="section" id="philosophy">
<h3>Philosophy<a class="headerlink" href="#philosophy" title="Permalink to this headline">¶</a></h3>
<p>A view is a “type” of Web page in your Django application that generally serves a specific
function and has a specific template. For example, in a Weblog application, you might
have the following views:</p>
<ul class="simple">
<li>Blog homepage – displays the latest few entries.</li>
<li>Entry “detail” page – permalink page for a single entry.</li>
<li>Year-based archive page – displays all months with entries in the given year.</li>
<li>Month-based archive page – displays all days with entries in the given month.</li>
<li>Day-based archive page – displays all entries in the given day.</li>
<li>Comment action – handles posting comments to a given entry.</li>
</ul>
<p>In our poll application, we’ll have the following four views:</p>
<ul class="simple">
<li>Poll “index” page – displays the latest few polls.</li>
<li>Poll “detail” page – displays a poll question, with no results but with a form to vote.</li>
<li>Poll “results” page – displays results for a particular poll.</li>
<li>Vote action – handles voting for a particular choice in a particular poll.</li>
</ul>
<p>In Django, each view is represented by a Python function.</p>
</div>
<div class="section" id="design-your-urls">
<h3>Design your URLs<a class="headerlink" href="#design-your-urls" title="Permalink to this headline">¶</a></h3>
<p>The first step of writing views is to design your URL structure. You do this by creating a
Python module, called a URLconf. URLconfs are how Django associates a given URL with
given Python code.</p>
<p>When a user requests a Django-powered page, the system looks at the <tt class="docutils literal"><span class="pre">ROOT_URLCONF</span></tt>
setting, which contains a string in Python dotted syntax.</p>
<p><strong>Pop quiz</strong>: what is the <tt class="docutils literal"><span class="pre">ROOT_URLCONF</span></tt> for your project?</p>
<p>Django loads that module and
looks for a module-level variable called urlpatterns, which is a sequence of tuples in the
following format:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">(</span>regular expression, Python callback <span class="k">function</span> <span class="o">[</span>, optional dictionary<span class="o">])</span>
</pre></div>
</div>
<p>Django starts at the first regular expression and makes its way down the list, comparing
the requested URL against each regular expression until it finds one that matches.</p>
<p>You might ask, &#8220;What&#8217;s a regular expression?&#8221; Regular expressions are patterns for matching
text. In this case, we&#8217;re matching the URLs people go to, and using regular expressions to
match whole &#8216;groups&#8217; of them at once.</p>
<p>(If you&#8217;d like to learn more about regular expressions read the
<a class="reference external" href="http://diveintopython.org/regular_expressions/index.html">Dive into Python guide to regular expressions</a> sometime.
Or you can look at this <a class="reference external" href="http://xkcd.com/208/">comic</a>.)</p>
<p>In addition to <tt class="docutils literal"><span class="pre">matching</span></tt> text, regular expressions can <tt class="docutils literal"><span class="pre">capture</span></tt> text: regexps use
parentheses to wrap the parts they&#8217;re capturing.</p>
<p>For Django, when a regular expression matches the URL that a web surfer requests,
Django extracts the captured values and passes them to a function of your choosing.
This is the role of the <tt class="docutils literal"><span class="pre">callback</span> <span class="pre">function</span></tt> above.  When a regular expression
matches the url, Django calls the associated <tt class="docutils literal"><span class="pre">callback</span> <span class="pre">function</span></tt> with any
<em>captured</em> parts as parameters.  This will much clearer after the next section.</p>
</div>
<div class="section" id="adding-urls-to-urls-py">
<h3>Adding URLs to urls.py<a class="headerlink" href="#adding-urls-to-urls-py" title="Permalink to this headline">¶</a></h3>
<p>When we ran django-admin.py startproject myproject to create the project,
Django created a default URLconf. Take a look at <tt class="docutils literal"><span class="pre">'settings.py</span></tt>&#8216; for this line:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">ROOT_URLCONF</span> <span class="o">=</span> <span class="s1">&#39;myproject.urls&#39;</span>
</pre></div>
</div>
<p>That means that the default URLconf is myproject/urls.py.</p>
<p>Time for an example. Edit the file myproject/urls.py so it looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
 <span class="p">(</span><span class="s">r&#39;^polls/$&#39;</span><span class="p">,</span> <span class="s">&#39;polls.views.index&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s">r&#39;^polls/(\d+)/$&#39;</span><span class="p">,</span> <span class="s">&#39;polls.views.detail&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s">r&#39;^polls/(\d+)/results/$&#39;</span><span class="p">,</span> <span class="s">&#39;polls.views.results&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s">r&#39;^polls/(\d+)/vote/$&#39;</span><span class="p">,</span> <span class="s">&#39;polls.views.vote&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This is worth a review. When somebody requests a page from your Web site
&#8211; say, &#8220;/polls/23/&#8221;, Django will load the <tt class="docutils literal"><span class="pre">urls.py</span></tt> Python module, because it&#8217;s
pointed to by the ROOT_URLCONF setting. It finds the variable named urlpatterns
and traverses the regular expressions in order. When it finds a regular expression that
matches &#8211; r&#8217;^polls/(d+)/$&#8217; &#8211; it loads the function detail() from polls/views.py. Finally,
it calls that detail() function like so:</p>
<div class="highlight-bash"><div class="highlight"><pre>detail<span class="o">(</span><span class="nv">request</span><span class="o">=</span>&lt;HttpRequest object&gt;, <span class="s1">&#39;23&#39;</span><span class="o">)</span>
</pre></div>
</div>
<p>The &#8216;23&#8217; part comes from (d+). Using parentheses around a pattern &#8220;captures&#8221; the
text matched by that pattern and sends it as an argument to the view function; the
d+ is a regular expression to match a sequence of <tt class="docutils literal"><span class="pre">digits</span></tt> (i.e., a number).</p>
<p>(In Django, you have total control over the way your URLs look. People on the web
won&#8217;t see cruft like .py or .php at the end of your URLs.)</p>
</div>
<div class="section" id="finally-write-your-first-view">
<h3>Finally: Write your first view<a class="headerlink" href="#finally-write-your-first-view" title="Permalink to this headline">¶</a></h3>
<p>Well, we haven&#8217;t created any views yet &#8211; we just have the URLconf. But
let&#8217;s make sure Django is following the URLconf properly.</p>
<p>Fire up the Django development Web server:</p>
<div class="highlight-bash"><div class="highlight"><pre>python manage.py runserver
</pre></div>
</div>
<p>Now go to &#8220;<a class="reference external" href="http://localhost:8000/polls/">http://localhost:8000/polls/</a>&#8221; in your Web browser.
You should get a pleasantly-colored error page with the following message:</p>
<div class="highlight-bash"><div class="highlight"><pre>ViewDoesNotExist at /polls/

Tried index in module polls.views. Error was: <span class="s1">&#39;module&#39;</span>
object has no attribute <span class="s1">&#39;index&#39;</span>
</pre></div>
</div>
<p>This error happened because you haven&#8217;t written a function index() in the module polls/views.py.</p>
<p>Try &#8220;/polls/23/&#8221;, &#8220;/polls/23/results/&#8221; and &#8220;/polls/23/vote/&#8221;. The error messages tell you which view
Django tried (and failed to find, because you haven&#8217;t written any views yet).</p>
<p>Time to write the first view. Open the file polls/views.py and put the following Python code in it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;Hello, world. You&#39;re at the poll index.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This is the simplest view possible. Save the views.py file, then go to &#8220;/polls/&#8221; in your
browser, and you should see your text.</p>
<p>Now let&#8217;s add a few more views by adding to the views.py file. These views are slightly
different, because they take an argument (which, remember, is passed in from whatever
was captured by the regular expression in the URLconf):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">poll_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;You&#39;re looking at poll </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">poll_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">results</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">poll_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;You&#39;re looking at the results of poll </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">poll_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">vote</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">poll_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;You&#39;re voting on poll </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">poll_id</span><span class="p">)</span>
</pre></div>
</div>
<p>Save the views.py file. Now take a look in your browser at &#8220;/polls/34/&#8221;. It&#8217;ll run the
detail() method and display whatever ID you provide in the URL. Try &#8220;/polls/34/results/&#8221;
and &#8220;/polls/34/vote/&#8221; too &#8211; these will display the placeholder results and voting pages.</p>
</div>
<div class="section" id="write-views-that-actually-do-something">
<h3>Write views that actually do something<a class="headerlink" href="#write-views-that-actually-do-something" title="Permalink to this headline">¶</a></h3>
<p>Each view is responsible for doing one of two things: Returning an HttpResponse
object containing the content for the requested page, or raising an exception such
as Http404. The rest is up to you.</p>
<p>Your view can read records from a database, or not. It can use a template system such
as Django&#8217;s &#8211; or not. It can generate a PDF file, output XML, create a ZIP file on the fly,
anything you want, using whatever Python libraries you want.</p>
<p>All Django wants is that HttpResponse. Or an exception.</p>
<p>Most of the Django views in the world use Django&#8217;s own database API, which we covered in
Tutorial 1. Let&#8217;s do that, too. Here&#8217;s one stab at the index() view, which displays the latest 5
poll questions in the system, separated by commas, according to publication date. Continue
editing the file views.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Poll</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">latest_poll_list</span> <span class="o">=</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-pub_date&#39;</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">question</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">latest_poll_list</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>Now go to &#8220;<a class="reference external" href="http://localhost:8000/polls/">http://localhost:8000/polls/</a>&#8221; in your Web browser. You should see the
text of the first poll. There&#8217;s a problem here, though: The page&#8217;s design is hard-coded
n the view. If you want to change the way the page looks, you&#8217;ll have to edit this Python
code. So let&#8217;s use Django&#8217;s template system to separate the design from Python:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span>
<span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Poll</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">latest_poll_list</span> <span class="o">=</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-pub_date&#39;</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;latest_poll_list&#39;</span><span class="p">:</span> <span class="n">latest_poll_list</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;polls/index.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p>To recap what this does:</p>
<ul class="simple">
<li>Creates a variable called <tt class="docutils literal"><span class="pre">latest_poll_list</span></tt>. Django queries the database for <tt class="docutils literal"><span class="pre">all</span></tt> Poll objects, ordered by <tt class="docutils literal"><span class="pre">pub_date</span></tt> with most recent first, and uses <tt class="docutils literal"><span class="pre">slicing</span></tt> to get the first five.</li>
<li>Creates a variable called <tt class="docutils literal"><span class="pre">context</span></tt> that is a dictionary with one key.</li>
<li>Evaluates the <tt class="docutils literal"><span class="pre">render_to_response</span></tt> function with two arguments, and returns whatever that returns.</li>
</ul>
<p><tt class="docutils literal"><span class="pre">render_to_response</span></tt> loads the template called &#8220;polls/index.html&#8221; and passes it a
value as <tt class="docutils literal"><span class="pre">context</span></tt>. The context is a dictionary mapping template variable names to
Python objects.</p>
<p>If you can read this this <tt class="docutils literal"><span class="pre">view</span></tt> function without being overwhelmed, then you understand
the basics of Django views. Now is a good time to reflect and make sure you do. (If you have
questions, ask a volunteer for help.)</p>
<p>Reload the page. Now you&#8217;ll see an error:</p>
<div class="highlight-bash"><div class="highlight"><pre>TemplateDoesNotExist at /polls/
polls/index.html
</pre></div>
</div>
<p>Ah. There&#8217;s no template yet. Let&#8217;s make one.</p>
<p>First, let&#8217;s make a directory where templates will live. We&#8217;ll need a templates
directory right alongside the <tt class="docutils literal"><span class="pre">views.py</span></tt> for the <tt class="docutils literal"><span class="pre">polls</span></tt> app. This is what I would do:</p>
<div class="highlight-bash"><div class="highlight"><pre>mkdir -p polls/templates/polls
</pre></div>
</div>
<p>Within that, create a file called index.html.</p>
<p>Put the following code in that template:</p>
<div class="highlight-html"><div class="highlight"><pre>{% if latest_poll_list %}
    <span class="nt">&lt;ul&gt;</span>
    {% for poll in latest_poll_list %}
        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/polls/{{ poll.id }}/&quot;</span><span class="nt">&gt;</span>{{ poll.question }}<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    {% endfor %}
    <span class="nt">&lt;/ul&gt;</span>
{% else %}
    <span class="nt">&lt;p&gt;</span>No polls are available.<span class="nt">&lt;/p&gt;</span>
{% endif %}
</pre></div>
</div>
<p>Load the page &#8220;<a class="reference external" href="http://localhost:8000/polls/">http://localhost:8000/polls/</a>&#8221; into your Web browser again, and
you should see a bulleted-list containing the &#8220;What&#8217;s up&#8221; poll from Tutorial 1.
The link points to the poll&#8217;s detail page.</p>
</div>
<div class="section" id="raising-404">
<h3>Raising 404<a class="headerlink" href="#raising-404" title="Permalink to this headline">¶</a></h3>
<p>Now, let&#8217;s tackle the poll detail view &#8211; the page that displays the question for a
given poll. Continue editing the <tt class="docutils literal"><span class="pre">views.py</span></tt> file. This view uses Python <tt class="docutils literal"><span class="pre">exceptions</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">Http404</span>
<span class="c"># ...</span>
<span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">poll_id</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">poll_id</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Poll</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Http404</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;polls/detail.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;poll&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">})</span>
</pre></div>
</div>
<p>The new concept here: The view raises the Http404 exception if a poll with the
requested ID doesn&#8217;t exist.</p>
<p>If you&#8217;d like to quickly get the above example working, just create a new template
file and name it <tt class="docutils literal"><span class="pre">detail.html</span></tt>. Enter in it just one line of code:</p>
<div class="highlight-html"><div class="highlight"><pre>{{ poll }}
</pre></div>
</div>
<p>to get you started for now.</p>
<p>Does your detail view work? Try it: <a class="reference external" href="http://127.0.0.1:8000/polls/1/">http://127.0.0.1:8000/polls/1/</a></p>
<p>You can also try to load a poll page that does not exist, just to test out the
pretty 404 error: <a class="reference external" href="http://127.0.0.1:8000/polls/32/">http://127.0.0.1:8000/polls/32/</a></p>
</div>
<div class="section" id="adding-more-detail">
<h3>Adding more detail<a class="headerlink" href="#adding-more-detail" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s give the detail view some more <tt class="docutils literal"><span class="pre">'detail</span></tt>&#8216;.</p>
<p>We pass in a variable called <tt class="docutils literal"><span class="pre">'poll</span></tt>&#8216; that points to an instance of the Poll class.
So you can pull out more information by writing this into the &#8220;polls/detail.html&#8221; template:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>{{ poll.question }}<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;ul&gt;</span>
{% for choice in poll.choice_set.all %}
    <span class="nt">&lt;li&gt;</span>{{ choice.choice }}<span class="nt">&lt;/li&gt;</span>
{% endfor %}
<span class="nt">&lt;/ul&gt;</span>
</pre></div>
</div>
<p>The template system uses dot-lookup syntax to access variable attributes.
Django&#8217;s template language is a bit sloppy: in pure Python, the <tt class="docutils literal"><span class="pre">'.</span></tt>&#8216; (dot) only
lets you get attributes from objects. In this example, we are just doing attribute
lookup, but in general if you&#8217;re not sure how to get data out of an object in Django, try <tt class="docutils literal"><span class="pre">'dot</span></tt>&#8216;.</p>
<p>Method-calling happens in the {% for %} loop: poll.choice_set.all is interpreted as the
Python code poll.choice_set.all(), which returns a sequence of Choice objects and is
suitable for use in the {% for %} tag.</p>
<p>Load the new detail page in your browser: <a class="reference external" href="http://127.0.0.1:8000/polls/1/">http://127.0.0.1:8000/polls/1/</a>
The poll choices now appear.</p>
</div>
</div>
<div class="section" id="part-xx-let-the-people-vote">
<h2>Part XX Let the people vote<a class="headerlink" href="#part-xx-let-the-people-vote" title="Permalink to this headline">¶</a></h2>
<div class="section" id="write-a-simple-form">
<h3>Write a simple form<a class="headerlink" href="#write-a-simple-form" title="Permalink to this headline">¶</a></h3>
<p>Let’s update our poll detail template (“polls/detail.html”) from the
last tutorial so that the template contains an HTML &lt;form&gt; element:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>{{ poll.question }}<span class="nt">&lt;/h1&gt;</span>

{% if error_message %}<span class="nt">&lt;p&gt;&lt;strong&gt;</span>{{ error_message }}<span class="nt">&lt;/strong&gt;&lt;/p&gt;</span>{% endif %}

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;/polls/{{ poll.id }}/vote/&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
{% csrf_token %}
{% for choice in poll.choice_set.all %}
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;radio&quot;</span> <span class="na">name=</span><span class="s">&quot;choice&quot;</span> <span class="na">value=</span><span class="s">&quot;{{ choice.id }}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;label&gt;</span>{{ choice.choice }}<span class="nt">&lt;/label&gt;&lt;br</span> <span class="nt">/&gt;</span>
{% endfor %}
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Vote&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<p>There is a lot going on there. A quick rundown:</p>
<ul class="simple">
<li>The above template displays a radio button for each poll choice. The value of each radio button is the associated poll choice&#8217;s ID. The name of each radio button is &#8220;choice&#8221;. That means, when somebody selects one of the radio buttons and submits the form, the form submission will represent the Python dictionary {&#8216;choice&#8217;: &#8216;3&#8217;}. That&#8217;s the basics of HTML forms; you can learn more about them.</li>
<li>We set the form&#8217;s action to /polls/{{ poll.id }}/vote/, and we set method=&#8221;post&#8221;. Normal web pages are requested using <tt class="docutils literal"><span class="pre">GET</span></tt>, but the standards for HTTP indicate that if you are changing data on the server, you must use the <tt class="docutils literal"><span class="pre">POST</span></tt> method. (Whenever you create a form that alters data server-side, use method=&#8221;post&#8221;. This tip isn&#8217;t specific to Django; it&#8217;s just good Web development practice.)</li>
<li>Since we&#8217;re creating a POST form (which can have the effect of modifying data), we need to worry about Cross Site Request Forgeries. Thankfully, you don&#8217;t have to worry too hard, because Django comes with a very easy-to-use system for protecting against it. In short, all POST forms that are targeted at internal URLs should use the {% csrf_token %} template tag.</li>
</ul>
<p>The {% csrf_token %} tag requires information from the request object, which is not
normally accessible from within the template context. To fix this, a small adjustment
needs to be made to the detail view in the &#8220;views.py&#8221; file, so that it looks like the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">RequestContext</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">render_to_response</span>
<span class="c"># ...</span>
<span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">poll_id</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Poll</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">poll_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;polls/detail.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;poll&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">},</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</pre></div>
</div>
<p>Notice we also added a function that checks if a 404 is returned for us, less lines of code! The details of how the RequestContext works are explained in the <a class="reference external" href="http://docs.djangoproject.com/en/dev/ref/templates/api/#subclassing-context-requestcontext">documentation for RequestContext</a></p>
<p>Now, let&#8217;s create a Django view that handles the submitted data and does something
with it. Remember, in Tutorial 3, we created a URLconf for the polls application that
includes this line:</p>
<div class="highlight-html"><div class="highlight"><pre>(r&#39;^(?P<span class="nt">&lt;poll</span><span class="na">_id</span><span class="nt">&gt;</span>\d+)/vote/$&#39;, &#39;vote&#39;),
</pre></div>
</div>
<p>We also created a dummy implementation of the vote() function. Let&#8217;s create a
real version. Add the following to polls/views.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">render_to_response</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponseRedirect</span><span class="p">,</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">RequestContext</span>
<span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Choice</span><span class="p">,</span> <span class="n">Poll</span>
<span class="c"># ...</span>
<span class="k">def</span> <span class="nf">vote</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">poll_id</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Poll</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">poll_id</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">selected_choice</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;choice&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">Choice</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">):</span>
        <span class="c"># Redisplay the poll voting form.</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;polls/detail.html&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s">&#39;poll&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span>
            <span class="s">&#39;error_message&#39;</span><span class="p">:</span> <span class="s">&quot;You didn&#39;t select a choice.&quot;</span><span class="p">,</span>
        <span class="p">},</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">selected_choice</span><span class="o">.</span><span class="n">votes</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">selected_choice</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="c"># Always return an HttpResponseRedirect after successfully dealing</span>
        <span class="c"># with POST data. This prevents data from being posted twice if a</span>
        <span class="c"># user hits the Back button.</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;polls.views.results&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">,)))</span>
</pre></div>
</div>
<p>This code includes a few things we haven&#8217;t covered yet in this tutorial:</p>
<ul class="simple">
<li>request.POST is a dictionary-like object that lets you access submitted data by key name. In this case, request.POST[&#8216;choice&#8217;] returns the ID of the selected choice, as a string. request.POST values are always strings.</li>
<li>Note that Django also provides request.GET for accessing GET data in the same way &#8211; but we&#8217;re explicitly using request.POST in our code, to ensure that data is only altered via a POST call.</li>
<li>request.POST[&#8216;choice&#8217;] will raise KeyError if choice wasn&#8217;t provided in POST data. The above code checks for KeyError and redisplays the poll form with an error message if choice isn&#8217;t given.</li>
<li>After incrementing the choice count, the code returns an HttpResponseRedirect rather than a normal HttpResponse. HttpResponseRedirect takes a single argument: the URL to which the user will be redirected (see the following point for how we construct the URL in this case).</li>
</ul>
<p>As the Python comment above points out, you should always return an HttpResponseRedirect
after successfully dealing with POST data. This tip isn&#8217;t specific to Django; it&#8217;s just good Web
development practice. That way, if the web surfer hits <tt class="docutils literal"><span class="pre">reload</span></tt>, they get the success page again,
rather than re-doing the action.</p>
<p>We are using the reverse() function in the HttpResponseRedirect constructor in this example.
This function helps avoid having to hardcode a URL in the view function. It is given the name
of the view that we want to pass control to and the variable portion of the URL pattern that points
to that view. In this case, using the URLconf we set up in Tutorial 3, this reverse() call will return
a string like</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="s1">&#39;/polls/3/results/&#39;</span>
</pre></div>
</div>
<p>where the 3 is the value of p.id. This redirected URL will then call the &#8216;results&#8217; view to display
the final page. Note that you need to use the full name of the view here (including the prefix).</p>
<p>After somebody votes in a poll, the vote() view redirects to the results page for the poll.
Let&#8217;s write that view:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">results</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">poll_id</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Poll</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">poll_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;polls/results.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;poll&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">})</span>
</pre></div>
</div>
<p>This is almost exactly the same as the detail() view from Tutorial 3. The only difference is the
template name. We&#8217;ll fix this redundancy later.</p>
<p>Now, create a results.html template:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>{{ poll.question }}<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
{% for choice in poll.choice_set.all %}
    <span class="nt">&lt;li&gt;</span>{{ choice.choice }} -- {{ choice.votes }} vote{{ choice.votes|pluralize }}<span class="nt">&lt;/li&gt;</span>
{% endfor %}
<span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/polls/{{ poll.id }}/&quot;</span><span class="nt">&gt;</span>Vote again?<span class="nt">&lt;/a&gt;</span>
</pre></div>
</div>
<p>Now, go to /polls/1/ in your browser and vote in the poll. You should see a results page
that gets updated each time you vote. If you submit the form without having chosen a
choice, you should see the error message.</p>
<p>Does it work?! If so, show your neighbor!</p>
</div>
</div>
<div class="section" id="part-xx-save-that-project">
<h2>Part XX Save that project!<a class="headerlink" href="#part-xx-save-that-project" title="Permalink to this headline">¶</a></h2>
<p>This is a great time to COMMIT!</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># in myprojects</span>
git add -A
git commit -m <span class="s2">&quot;My voting app works&quot;</span>
git push origin master
</pre></div>
</div>
</div>
<div class="section" id="part-xx-editing-your-polls-in-the-django-admin-interface">
<h2>Part XX Editing your polls in the Django admin interface<a class="headerlink" href="#part-xx-editing-your-polls-in-the-django-admin-interface" title="Permalink to this headline">¶</a></h2>
<p>So far, you&#8217;ve been adding data to your database using the <tt class="docutils literal"><span class="pre">manage.py</span> <span class="pre">shell</span></tt>.
This is a flexible way to add data, but it has some drawbacks:</p>
<ul class="simple">
<li>It&#8217;s not on the web.</li>
<li>A fanatical insistence on precision: You have to write Python code to add data, which means that typos or syntax errors could make your life harder.</li>
<li>An unnecessary lack of color.</li>
</ul>
<div class="section" id="background-django-s-built-in-admin-interface">
<h3>Background: Django&#8217;s built-in admin interface<a class="headerlink" href="#background-django-s-built-in-admin-interface" title="Permalink to this headline">¶</a></h3>
<p>Generating admin sites for your staff or clients to add, change and delete content is
tedious work that doesn’t require much creativity. For that reason, Django entirely
automates creation of admin interfaces for models.</p>
<p>Django was written in a newsroom environment, with a very clear separation between
“content publishers” and the “public” site. Site managers use the system to add news
stories, events, sports scores, etc., and that content is displayed on the public site.
Django solves the problem of creating a unified interface for site administrators to edit content.</p>
<p>The admin isn’t necessarily intended to be used by site visitors; it’s for site managers.</p>
</div>
<div class="section" id="activate-the-admin-site">
<h3>Activate the admin site<a class="headerlink" href="#activate-the-admin-site" title="Permalink to this headline">¶</a></h3>
<p>The Django admin site is not activated by default – it’s an opt-in thing.
To activate the admin site for your installation, do these three things:</p>
<ul class="simple">
<li>Open up <tt class="docutils literal"><span class="pre">'myproject/settings.py</span></tt>&#8216; and uncomment &#8220;django.contrib.admin&#8221; and &#8220;django.contrib.admindocs&#8221; in your INSTALLED_APPS setting.</li>
<li>Edit your <tt class="docutils literal"><span class="pre">'myproject/urls.py</span></tt>&#8216; file and uncomment the lines that reference the admin – there are four lines in total to uncomment.</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre>from django.contrib import admin
admin.autodiscover<span class="o">()</span>

<span class="c"># and</span>
<span class="o">(</span>r<span class="s1">&#39;^admin/doc/&#39;</span>, include<span class="o">(</span><span class="s1">&#39;django.contrib.admindocs.urls&#39;</span><span class="o">))</span>,
<span class="o">(</span>r<span class="s1">&#39;^admin/&#39;</span>, include<span class="o">(</span>admin.site.urls<span class="o">))</span>,
</pre></div>
</div>
<p>Since you have added a new application to INSTALLED_APPS, the database tables need to be updated:</p>
<div class="highlight-bash"><div class="highlight"><pre>python manage.py syncdb.
</pre></div>
</div>
</div>
<div class="section" id="start-the-development-server">
<h3>Start the development server<a class="headerlink" href="#start-the-development-server" title="Permalink to this headline">¶</a></h3>
<p>Let’s make sure the development server is running and explore the admin site.</p>
<p>Try going to <a class="reference external" href="http://127.0.0.1:8000/admin/">http://127.0.0.1:8000/admin/</a>. If it does not load, make sure you are
still running the development server. You can start the development server like so:</p>
<div class="highlight-python"><pre>python manage.py runserver</pre>
</div>
<p><a class="reference external" href="http://127.0.0.1:8000/admin/">http://127.0.0.1:8000/admin/</a> should show you the admin site&#8217;s login screen.</p>
</div>
<div class="section" id="enter-the-admin-site">
<h3>Enter the admin site<a class="headerlink" href="#enter-the-admin-site" title="Permalink to this headline">¶</a></h3>
<p>Now, try logging in. (You created a superuser account earlier, when running <tt class="docutils literal"><span class="pre">syncdb</span></tt> for
the fist time. If you didn&#8217;t create one or forgot the password you can create another one.)
You should see the Django admin index page.</p>
<p>You should see a few other types of editable content, including groups, users and sites.
These are core features Django ships with by default.</p>
</div>
<div class="section" id="make-the-poll-app-modifiable-in-the-admin">
<h3>Make the poll app modifiable in the admin<a class="headerlink" href="#make-the-poll-app-modifiable-in-the-admin" title="Permalink to this headline">¶</a></h3>
<p>But where&#8217;s our poll app? It&#8217;s not displayed on the admin index page.</p>
<p>Just one thing to do: We need to tell the admin that Poll objects have an admin
interface. To do this, create a file called admin.py in your polls directory, and edit it to look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Poll</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Poll</span><span class="p">)</span>
</pre></div>
</div>
<p>You&#8217;ll need to restart the development server to see your changes. Normally,
the server auto-reloads code every time you modify a file, but the action of
creating a new file doesn&#8217;t trigger the auto-reloading logic. You can stop it by
typing <tt class="docutils literal"><span class="pre">'Ctrl-C</span></tt>&#8216; (<tt class="docutils literal"><span class="pre">'Ctrl-Break</span></tt>&#8216; on Windows); then use the <tt class="docutils literal"><span class="pre">'up</span></tt>&#8216; arrow on your
keyboard to find the command again, and hit enter.</p>
</div>
<div class="section" id="explore-the-free-admin-functionality">
<h3>Explore the free admin functionality<a class="headerlink" href="#explore-the-free-admin-functionality" title="Permalink to this headline">¶</a></h3>
<p>Now that we&#8217;ve registered Poll, Django knows that it should be displayed on the admin index page.</p>
<p>Click &#8220;Polls.&#8221; Now you&#8217;re at the &#8220;change list&#8221; page for polls. This page displays all the polls
in the database and lets you choose one to change it. There&#8217;s the &#8220;What&#8217;s up?&#8221; poll we
created in the first tutorial.</p>
<p>Things to note here:</p>
<ul class="simple">
<li>The form is automatically generated from the Poll model.</li>
<li>The different model field types (DateTimeField, CharField) correspond to the appropriate HTML input widget. Each type of field knows how to display itself in the Django admin.</li>
<li>Each DateTimeField gets free JavaScript shortcuts. Dates get a &#8220;Today&#8221; shortcut and calendar popup, and times get a &#8220;Now&#8221; shortcut and a convenient popup that lists commonly entered times.</li>
</ul>
<p>The bottom part of the page gives you a couple of options:</p>
<ul class="simple">
<li>Save &#8211; Saves changes and returns to the change-list page for this type of object.</li>
<li>Save and continue editing &#8211; Saves changes and reloads the admin page for this object.</li>
<li>Save and add another &#8211; Saves changes and loads a new, blank form for this type of object.</li>
<li>Delete &#8211; Displays a delete confirmation page.</li>
</ul>
<p>Change the &#8220;Date published&#8221; by clicking the &#8220;Today&#8221; and &#8220;Now&#8221; shortcuts. Then click
&#8220;Save and continue editing.&#8221; Then click &#8220;History&#8221; in the upper right. You&#8217;ll see a page
listing all changes made to this object via the Django admin, with the timestamp and
username of the person who made the change:</p>
<p>History page for poll object</p>
</div>
<div class="section" id="adding-related-objects">
<h3>Adding related objects<a class="headerlink" href="#adding-related-objects" title="Permalink to this headline">¶</a></h3>
<p>OK, we have our Poll admin page. But a Poll has multiple Choices, and the admin
page doesn&#8217;t display choices.</p>
<p>Yet.</p>
<p>There are two ways to solve this problem. The first is to register Choice with the
admin just as we did with Poll. That&#8217;s easy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Choice</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Choice</span><span class="p">)</span>
</pre></div>
</div>
<p>Now &#8220;Choices&#8221; is an available option in the Django admin. Check out the <tt class="docutils literal"><span class="pre">'Add</span> <span class="pre">Choice</span></tt>&#8216; form.</p>
<p>In that form, the &#8220;Poll&#8221; field is a select box containing every poll in the database.
Django knows that a ForeignKey should be represented in the admin as a &lt;select&gt;
box. In our case, only one poll exists at this point.</p>
<p>Also note the &#8220;Add Another&#8221; link next to &#8220;Poll.&#8221; Every object with a ForeignKey
relationship to another gets this for free. When you click &#8220;Add Another,&#8221; you&#8217;ll get a
popup window with the &#8220;Add poll&#8221; form. If you add a poll in that window and click
&#8220;Save,&#8221; Django will save the poll to the database and dynamically add it as the selected
choice on the &#8220;Add choice&#8221; form you&#8217;re looking at.</p>
<p>But, really, this is an inefficient way of adding Choice objects to the system. It&#8217;d be better
if you could add a bunch of Choices directly when you create the Poll object. Let&#8217;s make
that happen.</p>
<p>Remove the register() call for the Choice model. Then, edit the Poll registration code to read:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ChoiceInline</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">StackedInline</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Choice</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="mi">3</span>

<span class="k">class</span> <span class="nc">PollAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">fieldsets</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="bp">None</span><span class="p">,</span>               <span class="p">{</span><span class="s">&#39;fields&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;question&#39;</span><span class="p">]}),</span>
        <span class="p">(</span><span class="s">&#39;Date information&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;fields&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;pub_date&#39;</span><span class="p">],</span> <span class="s">&#39;classes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;collapse&#39;</span><span class="p">]}),</span>
    <span class="p">]</span>
    <span class="n">inlines</span> <span class="o">=</span> <span class="p">[</span><span class="n">ChoiceInline</span><span class="p">]</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Poll</span><span class="p">,</span> <span class="n">PollAdmin</span><span class="p">)</span>
</pre></div>
</div>
<p>This tells Django: &#8220;Choice objects are edited on the Poll admin page.
By default, provide enough fields for 3 choices.&#8221;</p>
<p>Load the &#8220;Add poll&#8221; page to see how that looks, you may need to
restart your development server:</p>
<p>It works like this: There are three slots for related Choices
&#8211; as specified by extra &#8211; and each time you come back to
the &#8220;Change&#8221; page for an already-created object, you get another three extra slots.</p>
</div>
<div class="section" id="customize-the-admin-change-list">
<h3>Customize the admin change list<a class="headerlink" href="#customize-the-admin-change-list" title="Permalink to this headline">¶</a></h3>
<p>Now that the Poll admin page is looking good, let&#8217;s make some
tweaks to the admin &#8220;change list&#8221; page &#8211; the one that displays
all the polls in the system.</p>
<p>By default, Django displays the str() of each object.
But sometimes it&#8217;d be more helpful if we could display
individual fields. To do that, use the list_display admin
option, which is a tuple of field names to display, as
columns, on the change list page for the object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PollAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;question&#39;</span><span class="p">,</span> <span class="s">&#39;pub_date&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Just for good measure, let&#8217;s also include the was_published_today
custom method from Tutorial 1:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PollAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;question&#39;</span><span class="p">,</span> <span class="s">&#39;pub_date&#39;</span><span class="p">,</span> <span class="s">&#39;was_published_today&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, check out the polls list.</p>
<p>You can click on the column headers to sort by those values &#8211;
except in the case of the was_published_today header, because
sorting by the output of an arbitrary method is not supported.
Also note that the column header for was_published_today is,
by default, the name of the method (with underscores replaced with spaces).</p>
<p>This is shaping up well. Let&#8217;s add some search capability. Add this to <tt class="docutils literal"><span class="pre">'class</span> <span class="pre">PollAdmin</span></tt>&#8216;:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PollAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
<span class="c"># ...</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;question&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>That adds a search box at the top of the change list. When somebody
enters search terms, Django will search the question field. You can use
as many fields as you&#8217;d like &#8211; although because it uses a LIKE query
behind the scenes, keep it reasonable, to keep your database happy.</p>
<p>Finally, because Poll objects have dates, it&#8217;d be convenient to be
able to drill down by date. Add this line:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PollAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
<span class="c"># ...</span>
    <span class="n">date_hierarchy</span> <span class="o">=</span> <span class="s">&#39;pub_date&#39;</span>
</pre></div>
</div>
<p>That adds hierarchical navigation, by date, to the top
of the change list page. At top level, it displays all available
years. Then it drills down to months and, ultimately, days.</p>
<p>That&#8217;s the basics of the Django admin interface!</p>
<p>Create a poll! Create some choices. Find your views, and show them to the world.</p>
</div>
</div>
<div class="section" id="part-xx-commit-again">
<h2>Part XX Commit, again!<a class="headerlink" href="#part-xx-commit-again" title="Permalink to this headline">¶</a></h2>
<p>You know what to do now, right? :)</p>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup_machine.html">Setup Your Machine!</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Intro to Programming Python: Web App</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#part-xx-if-you-build-it-they-will-pay-you">Part XX:  If You Build It... They Will Pay You</a></li>
<li class="toctree-l2"><a class="reference internal" href="#part-xx-create-your-django-app">Part XX Create your Django App</a></li>
<li class="toctree-l2"><a class="reference internal" href="#part-xx-save-your-work">Part XX Save your work!</a></li>
<li class="toctree-l2"><a class="reference internal" href="#part-xx-configure-your-django-project">Part XX:  Configure your Django Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="#part-xx-test-your-django-app">Part XX Test your Django App</a></li>
<li class="toctree-l2"><a class="reference internal" href="#part-xx-philosphy-break">Part XX  Philosphy Break!</a></li>
<li class="toctree-l2"><a class="reference internal" href="#part-xx-build-the-polls-application">Part XX Build The Polls Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#part-xx-letting-the-local-world-see-your-polls-with-views">Part XX Letting the (local) world see your polls, with views</a></li>
<li class="toctree-l2"><a class="reference internal" href="#part-xx-let-the-people-vote">Part XX Let the people vote</a></li>
<li class="toctree-l2"><a class="reference internal" href="#part-xx-save-that-project">Part XX Save that project!</a></li>
<li class="toctree-l2"><a class="reference internal" href="#part-xx-editing-your-polls-in-the-django-admin-interface">Part XX Editing your polls in the Django admin interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="#part-xx-commit-again">Part XX Commit, again!</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="webapp_answers.html">Answers for Webapp Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="webapp_answers.html#how-do-i-save-my-work">How Do I save my work?</a></li>
<li class="toctree-l1"><a class="reference internal" href="webapp_answers.html#how-do-i-test-my-work">How Do I test my work?</a></li>
<li class="toctree-l1"><a class="reference internal" href="webapp_answers.html#what-are-these-pyc-files-anyway">What are these .pyc files anyway?</a></li>
<li class="toctree-l1"><a class="reference internal" href="colorwall.html">Intro to Programming Python: Color Wall</a></li>
<li class="toctree-l1"><a class="reference internal" href="datatypes.html">Intro to Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="brainstorming.html">Brainstorming</a></li>
</ul>

          <h3 style="margin-top: 1.5em;">Search</h3>
          <form class="search" action="search.html" method="get">
            <input type="text" name="q" size="18" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Enter search terms or a module, class or function name.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="dependencies/dep-django.html" title="7. django"
             >previous</a> |
          <a href="webapp_answers.html" title="Answers for Webapp Questions"
             >next</a>
            <br/>
            <a href="_sources/webapp.txt"
               rel="nofollow">Show Source</a>
        </div>

        <div class="right">
          
    <div class="footer">
      Last updated on Mar 22, 2011.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>